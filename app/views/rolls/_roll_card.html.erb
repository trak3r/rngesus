<div id="<%= dom_id(roll) %>" class="card-index flex flex-col group p-4 min-h-[220px] transition-transform hover:-rotate-1 relative <%= 'opacity-60 grayscale' if roll.discarded? %>">

  <!-- Deleted Stamp (for discarded rolls) -->
  <% if roll.discarded? && current_user == roll.user %>
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-30">
      <div class="transform -rotate-14 border-8 border-red-600 text-red-600 font-bold text-5xl px-6 py-4 pt-6 rounded-lg opacity-80 font-typewriter">
        <%= t('rolls.index.deleted') %>
      </div>
    </div>
  <!-- Attention Needed Stamp (for imcomplete rolls) -->
  <% elsif roll.needs_attention? && current_user == roll.user %>
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-30">
      <div class="text-orange-600 opacity-60">
        <%= icon('exclamation-circle', class: "w-40 h-40") %>
      </div>
    </div>
  <% end %>

  <!-- Tag Badges (Push Pin Style) -->
  <% if roll.tags.any? %>
    <div class="absolute -top-3 left-1/2 -translate-x-1/2 z-20 flex gap-2">
      <% roll.tags.each do |tag| %>
        <%= link_to tag.name,
            rolls_path(tag: tag.name),
            class: "badge badge-outline border-2 border-base-content/20 bg-base-100 text-base-content/70 hover:border-base-content hover:text-base-content transition-all font-handwriting text-sm shadow-sm transform hover:scale-105",
            data: { turbo_frame: "_top" },
            onclick: "event.stopPropagation();" %>
      <% end %>
    </div>
  <% end %>

  <!-- Like Button (Top Right) -->
  <%= render "like_button", roll: roll, read_only: true %>

  <%= link_to roll,
              class: "flex-1 flex items-center justify-center pt-6 no-underline text-inherit #{'pointer-events-none' if roll.discarded?}",
              data: { turbo_frame: "_top" } do %>
    <h2 class="card-title text-2xl font-bold font-typewriter text-center line-clamp-2 pt-8">
      <%= roll.name %>
    </h2>
  <% end %>

  <div class="card-actions grid grid-cols-3 items-center mt-4 pt-3">
    <!-- Delete Button (Left) -->
    <div class="justify-self-start">
      <% if current_user == roll.user && @tab == 'your_rolls' %>
        <%= button_to roll_path(roll, tab: @tab),
                      method: :delete,
                      data: { turbo_confirm: "Are you sure you want to delete this roll?" },
                      class: "p-2 transition-colors flex items-center justify-center #{roll.discarded? ? 'opacity-30 pointer-events-none' : 'text-base-content/30 hover:text-red-600'}",
                      title: "Delete" do %>
          <%= icon(:trash, class: "w-6 h-6") %>
        <% end %>
      <% end %>
    </div>

    <!-- Share Button (Center) -->
    <%= render "share_button", roll: roll, container_class: "justify-self-center" %>

    <!-- Edit Button (Right) -->
    <div class="justify-self-end">
      <% if current_user == roll.user %>
        <%= link_to edit_roll_path(roll),
                    class: "p-1 rounded flex items-center gap-1 transition-colors #{roll.discarded? ? 'opacity-30 pointer-events-none' : 'text-base-content/50 hover:text-base-content'}",
                    title: "Edit",
                    data: { turbo_frame: "_top" } do %>
          <%= icon(:edit, class: "w-6 h-6") %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
