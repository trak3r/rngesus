<div id="<%= dom_id(roll) %>" class="card-index flex flex-col group p-4 min-h-[220px] transition-transform hover:-rotate-1 relative <%= 'opacity-60 grayscale' if roll.discarded? %>">

  <!-- Deleted Stamp (for discarded rolls) -->
  <% if roll.discarded? && current_user == roll.user %>
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-30">
      <div class="transform -rotate-14 border-8 border-red-600 text-red-600 font-bold text-5xl px-6 py-4 pt-6 rounded-lg opacity-80 font-typewriter">
        <%= t('rolls.index.deleted') %>
      </div>
    </div>
  <!-- Attention Needed Stamp (for imcomplete rolls) -->
  <% elsif roll.needs_attention? && current_user == roll.user %>
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-30">
      <div class="text-orange-600 opacity-60">
        <%= icon('exclamation-circle', class: "w-40 h-40") %>
      </div>
    </div>
  <% end %>

  <!-- Tag Badges (Push Pin Style) -->
  <% if roll.tags.any? %>
    <div class="absolute -top-3 left-1/2 -translate-x-1/2 z-20 flex gap-2">
      <% roll.tags.each do |tag| %>
        <%= link_to tag.name,
            rolls_path(tag: tag.name),
            class: "badge badge-outline border-2 border-base-content/20 bg-base-100 text-base-content/70 hover:border-base-content hover:text-base-content transition-all font-handwriting text-sm shadow-sm transform hover:scale-105",
            data: { turbo_frame: "_top" },
            onclick: "event.stopPropagation();" %>
      <% end %>
    </div>
  <% end %>

  <!-- Like Button (Top Right) -->
  <%= render "like_button", roll: roll, read_only: true %>

  <%= link_to roll, # links to show page
              class: "flex-1 flex flex-col no-underline text-inherit pt-1 #{'pointer-events-none' if roll.discarded?}",
              data: { turbo_frame: "_top" } do %>

    <h2 class="card-title text-xl font-bold mb-3 pr-16 font-typewriter border-b border-red-300 pb-1 line-clamp-1">
      <%= roll.name %>
    </h2>

    <div class="flex-1 text-base-content/80 flex flex-col gap-1 font-handwriting text-lg">
       <div class="text-sm text-base-content/60 mt-1">
         Sample of 
         <%= roll.results.count %> 
         (<%= roll.dice %>)
         possible results
       </div>
       <div class="leading-tight flex items-center gap-2">
       <% value, result = roll.outcome %>
          <span class="font-small text-lg line-clamp-2"><%= result&.name || "No Result" %></span>
       </div>
    </div>

  <% end %>

  <div class="card-actions grid grid-cols-3 items-center mt-4 border-t border-blue-200 pt-3">
    <!-- Owner Avatar and Edit Button (Left) -->
    <div class="flex items-center gap-2 justify-self-start">
      <% if roll.user&.email.present? %>
        <%= image_tag gravatar_url(roll.user, size: 32),
                      alt: "#{roll.user.display_name}'s avatar",
                      title: "Created by #{roll.user.display_name}",
                      class: "w-8 h-8 rounded-full border border-gray-400 grayscale hover:grayscale-0 transition-all" %>
      <% end %>

      <% if current_user == roll.user %>
        <%= link_to edit_roll_path(roll),
                    class: "p-1 rounded flex items-center gap-1 transition-colors #{roll.discarded? ? 'opacity-30 pointer-events-none' : 'text-base-content/50 hover:text-base-content'}",
                    title: "Edit",
                    data: { turbo_frame: "_top" } do %>
          <%= icon(:edit, class: "w-6 h-6") %>
        <% end %>
      <% end %>
    </div>

    <!-- Delete Button (Center) -->
    <div class="justify-self-center">
      <% if current_user == roll.user && @tab == 'your_rolls' %>
        <%= button_to roll_path(roll, tab: @tab),
                      method: :delete,
                      data: { turbo_confirm: "Are you sure you want to delete this roll?" },
                      class: "p-2 transition-colors flex items-center justify-center #{roll.discarded? ? 'opacity-30 pointer-events-none' : 'text-base-content/30 hover:text-red-600'}",
                      title: "Delete" do %>
          <%= icon(:trash, class: "w-6 h-6") %>
        <% end %>
      <% end %>
    </div>

    <%#= render "share_button", roll: roll %>
  </div>
</div>
