<%= turbo_frame_tag dom_id(roll, :outcome),
                     class: "w-full",
                     data: {
                       controller: "slot-machine dice",
                       slot_machine_final_result_value: result.try(:name_with_rolls) || 'No match',
                       slot_machine_all_results_value: roll.results.map(&:name).to_json,
                       slot_machine_index_value: local_assigns.fetch(:index, 0),
                       dice_dice_value: roll.dice,
                       dice_result_value: result.try(:name_with_rolls) || 'No match',
                       dice_rolled_value: rolled,
                       dice_animate_value: local_assigns.fetch(:animate, true)
                     } do %>
  <div class="card-index w-full hover:shadow-lg transition-all duration-300 flex flex-col items-center hover:scale-[1.02] active:scale-[0.98] relative min-h-[14rem]"> <!-- Added min-h here to ensure wrapper matches content -->
    
    <!-- Inner Container for Clipping (Background, Ribbon, Content) -->
    <div class="absolute inset-0 overflow-hidden rounded-2xl border border-base-200 bg-base-100"> <!-- added border/bg/rounded matching card-index style -->
        <!-- Re-roll Ribbon (always visible, touch-friendly) -->
        <%= button_to reroll_roll_path(roll),
                    method: :post,
                    class: 'absolute bottom-[20px] right-[-66px] w-[200px] bg-pencil text-white text-xs font-typewriter py-1 text-center transform rotate-[-45deg] shadow-lg z-50 border border-white/20 cursor-pointer',
                    form: { class: "w-full" } do %>
          re-roll
        <% end %>

        <div class="h-full flex flex-col items-center justify-center p-12">
            <% if roll.tags.any? %>
              <div class="absolute top-4 left-0 right-0 flex justify-center gap-2 px-8">
                <% roll.tags.each do |tag| %>
                  <span class="badge badge-outline badge-sm font-handwriting"><%= tag.name %></span>
                <% end %>
              </div>
            <% end %>

            <div class="relative group inline-block text-4xl sm:text-5xl font-bold font-typewriter text-center text-base-content mt-4">
              <span class="block group-hover:hidden" data-slot-machine-target="result">
                <%= result.try(:name_with_rolls) || 'No match' %>
              </span>
              <span class="hidden group-hover:block text-base-content/70">
                <%= result.try(:name) || 'No match' %>
              </span>
            </div>
        </div>
    </div>

    <!-- Bubble (Outside Clipping) -->
    <div class="absolute top-[-25px] left-[-25px] w-20 h-20 rounded-full bg-base-100 border-4 border-base-content shadow-lg flex items-center justify-center transform -rotate-12 z-20 font-handwriting text-3xl font-bold text-base-content">
      <%= rolled %>
    </div>
  </div>
<% end %>
