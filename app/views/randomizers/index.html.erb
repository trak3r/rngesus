<% content_for :title, "Randomizers" %>

<div class="w-full">
  <div class="flex flex-wrap gap-4">
    <div class="w-full mb-4" data-controller="search">
      <%= form_with url: randomizers_path, method: :get, 
          data: { search_target: "form", turbo_frame: "randomizers", turbo_action: "advance" } do |f| %>
        <%= f.text_field :query, 
            placeholder: "Search randomizers...", 
            class: "input input-bordered w-full max-w-xs",
            value: params[:query],
            data: { action: "input->search#submit", search_target: "input" } %>
      <% end %>
    </div>

    <%= turbo_frame_tag "randomizers", class: "contents" do %>
      <% if @randomizers.empty? %>
        <div class="w-full text-center p-8 text-base-content/50">
          No randomizers found matching "<%= params[:query] %>"
        </div>
      <% end %>

<div class="card bg-base-100 w-96 shadow-sm flex flex-col group
             p-4 min-h-[180px]
            bg-gradient-to-b from-base-100 to-base-200">
  <%= link_to new_randomizer_path,
              class: "flex-1 flex flex-col no-underline text-inherit" do %>

    <h2 class="card-title text-xl font-bold mb-2">New Randomizer</h2>

    <p class="flex-1 text-base-content/70">
      Create your own!
    </p>

  <% end %>
</div>

    <% @randomizers.each do |randomizer| %>

<div class="card w-96 shadow-sm flex flex-col group p-4 min-h-[180px]
            bg-gradient-to-br from-primary/5 to-primary/10
            hover:from-primary/10 hover:to-primary/20 transition-all duration-200">
  <%= link_to randomizer_outcomes_path(randomizer),
              class: "flex-1 flex flex-col no-underline text-inherit" do %>

    <h2 class="card-title text-xl font-bold mb-2">
      <%= randomizer.name %>
    </h2>

    <p class="flex-1 text-base-content/70">
      <%= randomizer.rolls
            .map { |r| h(r.name || 'Missing') }
            .join(' &middot; ')
            .html_safe %>
    </p>

  <% end %>

  <!-- Bottom row with email (left) and edit button (right) -->
  <div class="card-actions justify-between items-center mt-4 flex flex-row space-x-3 pb-2 pr-2">
    <em class="text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
      <%= randomizer.user.email %>
    </em>

    <%= link_to randomizer,
                class: "text-base-content/50 hover:text-base-content p-2 rounded" do %>
      <%= icon(:edit, class: "w-5 h-5") %>
    <% end %>
  </div>
</div>

    <% end %>
    <% end %>
  </div>
</div>
